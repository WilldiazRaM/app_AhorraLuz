{% extends "base.html" %}
{% block title %}Registrar Usuario — AhorraLuz{% endblock %}

{% block extra_css %}
<style>
  :root {
    --brand:#2ecc71;
    --brand-600:#27ae60;
    --brand-50:#eafaf1;
  }
  .admin-card{ border:0; border-radius:1rem; box-shadow:0 12px 38px rgba(0,0,0,.08); }
  .admin-header{ background:linear-gradient(180deg,var(--brand-50),#fff 70%); border-bottom:1px solid rgba(0,0,0,.06); }
  .btn-brand{ background:var(--brand); border-color:var(--brand); color:#fff; }
  .btn-brand:hover{ background:var(--brand-600); border-color:var(--brand-600); }
  .input-group-text{ background:var(--brand-50); border-color:#dee2e6; }
  .form-control:focus{ border-color:var(--brand); box-shadow:0 0 0 .25rem rgba(46,204,113,.15); }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="card admin-card">
    <div class="admin-header p-4">
      <h2 class="h4 fw-bold mb-0"><i class="fa-solid fa-user-plus me-2 text-success"></i>Registrar nuevo usuario</h2>
      <p class="text-secondary mb-0 small">Todos los datos sensibles se guardan cifrados.</p>
    </div>

    <div class="card-body p-4 p-md-5">
      <form method="post" novalidate id="registerForm" aria-labelledby="formTitle">
        {% csrf_token %}
        <div class="row g-4">
          <div class="col-md-6">
            <label for="id_email" class="form-label">Correo electrónico</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-envelope"></i></span>
              {{ form.email }}
            </div>
          </div>
          <div class="col-md-6">
            <label for="id_nombres" class="form-label">Nombres</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-id-badge"></i></span>
              {{ form.nombres }}
            </div>
          </div>
          <div class="col-md-6">
            <label for="id_apellidos" class="form-label">Apellidos</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
              {{ form.apellidos }}
            </div>
          </div>
          <div class="col-md-6">
            <label for="id_rut" class="form-label">RUT</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-id-card-clip"></i></span>
              {{ form.rut }}
            </div>
          </div>

          <!-- Contraseña -->
          <div class="col-md-6">
            <label for="id_password" class="form-label">Contraseña</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
              {{ form.password }}
              <button class="btn btn-outline-secondary" type="button" id="togglePassword" aria-label="Mostrar u ocultar contraseña">
                <i class="fa-regular fa-eye"></i>
              </button>
            </div>
          </div>

          <!-- Confirmación -->
          <div class="col-md-6">
            <label for="id_password2" class="form-label">Confirmar contraseña</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
              <input type="password" class="form-control" id="id_password2" name="password2"
                     placeholder="Repite la contraseña" autocomplete="new-password"
                     aria-label="Confirmar contraseña" required>
            </div>
            <div id="pwdMatchMsg" class="form-text"></div>
          </div>
        </div>

        <div class="mt-4 d-flex justify-content-end">
          <button type="submit" class="btn btn-brand btn-lg" id="submitBtn">
            <i class="fa-solid fa-check me-2"></i>Guardar Usuario
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function(){
  const pwd1 = document.getElementById('id_password');
  const pwd2 = document.getElementById('id_password2');
  const msg  = document.getElementById('pwdMatchMsg');
  const btn  = document.getElementById('submitBtn');

  function checkMatch(){
    const val1 = pwd1.value.trim();
    const val2 = pwd2.value.trim();
    if(!val2){ msg.textContent = ''; btn.disabled = false; return; }
    if(val1 === val2){
      msg.textContent = 'Las contraseñas coinciden';
      msg.className = 'form-text text-success';
      btn.disabled = false;
    }else{
      msg.textContent = '❌ Las contraseñas no coinciden ❌';
      msg.className = 'form-text text-danger';
      btn.disabled = true;
    }
  }
  pwd1.addEventListener('input', checkMatch);
  pwd2.addEventListener('input', checkMatch);

  // Toggle visibilidad contraseña
  const toggle = document.getElementById('togglePassword');
  if(toggle && pwd1){
    toggle.addEventListener('click', () => {
      const type = pwd1.type === 'password' ? 'text' : 'password';
      pwd1.type = type;
      const icon = toggle.querySelector('i');
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });
  }
})();
</script>
{% endblock %}
