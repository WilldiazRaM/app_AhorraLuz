{% load static %}
<!doctype html>
<html lang="es" data-bs-theme="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% block title %}AppWeb AhorraLuz{% endblock %}</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

  <!-- Font Awesome (tu kit) -->
  <script src="https://kit.fontawesome.com/ddcff51474.js" crossorigin="anonymous"></script>

  <!-- Estilos propios -->
  <link rel="stylesheet" href="{% static 'core/css/main.css' %}">

  {% block extra_css %}{% endblock %}

  <style>
    :root {
      --brand: #2ecc71;
      /* verde principal */
      --brand-600: #27ae60;
      /* hover */
      --brand-50: #eafaf1;
      /* fondo suave */
      --ink: #212529;
    }

    body {
      padding-top: 4.25rem;
    }

    /* compensa navbar fixed-top */

    .navbar {
      background: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .06);
    }

    .navbar .nav-link:hover,
    .navbar .nav-link:focus {
      color: var(--brand-600) !important;
    }

    .btn-brand {
      background: var(--brand);
      border-color: var(--brand);
      color: #fff;
    }

    .btn-brand:hover {
      background: var(--brand-600);
      border-color: var(--brand-600);
    }

    /* Layout sticky footer */
    .page {
      min-height: 100svh;
      display: flex;
      flex-direction: column;
    }

    main.page-body {
      flex: 1 1 auto;
    }

    /* Contenido centrado cómodo */
    .center-wrap {
      max-width: 1100px;
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>

<body>
  <div class="page">

    <!-- NAVBAR (fijo) -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'core:home' %}">
          <span class="d-inline-flex justify-content-center align-items-center rounded-circle"
            style="width:36px;height:36px;background:var(--brand-50);">
            <i class="fa-solid fa-leaf" style="color:var(--brand)"></i>
          </span>
          AhorraLuz
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topbar"
          aria-controls="topbar" aria-expanded="false" aria-label="Mostrar navegación">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="topbar">
          <!-- Izquierda -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="{% url 'core:home' %}"><i class="fa-solid fa-house"></i>
                Inicio</a></li>

            {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link" href="{% url 'core:dashboard' %}"><i
                  class="fa-solid fa-gauge-high"></i> Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'core:profile' %}"><i class="fa-solid fa-id-card"></i>
                Perfil</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'core:consumo_new' %}"><i
                  class="fa-solid fa-plus-circle"></i> Consumo nuevo</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'core:consumo_history' %}"><i
                  class="fa-solid fa-chart-line"></i> Historial</a></li>
            {% endif %}

            <!-- Páginas públicas aún sin URL: href vacío -->
            <li class="nav-item"><a class="nav-link" href=""><i class="fa-regular fa-comments"></i> Reseñas</a></li>
            <li class="nav-item"><a class="nav-link" href=""><i class="fa-solid fa-circle-info"></i> Acerca de</a></li>
            <li class="nav-item"><a class="nav-link" href=""><i class="fa-solid fa-envelope"></i> Contacto</a></li>
          </ul>

          <!-- Derecha -->
          <ul class="navbar-nav mb-2 mb-lg-0">
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa-solid fa-circle-user"></i>
                <span class="d-none d-sm-inline">{{ user.get_full_name|default:user.username }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li class="px-3 py-2 small text-muted">Sesión iniciada</li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li>
                  <form action="{% url 'core:logout' %}" method="post" class="px-3 pb-2">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-outline-danger w-100">
                      <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
                    </button>
                  </form>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="btn btn-brand" href="{% url 'core:login' %}">
                <i class="fa-solid fa-right-to-bracket"></i> Ingresar
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
        {% if user.is_superuser %}
        <button class="btn btn-outline-success ms-3" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#adminPanel" aria-controls="adminPanel">
          <i class="fa-solid fa-user-gear"></i> Admin
        </button>
        {% endif %}

      </div>
    </nav>
    {% if user.is_superuser %}
        <div class="offcanvas offcanvas-end" tabindex="-1" id="adminPanel" aria-labelledby="adminPanelLabel">
          <div class="offcanvas-header">
            <h5 id="adminPanelLabel"><i class="fa-solid fa-screwdriver-wrench me-2"></i>Panel Administrativo</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
          </div>
          <div class="offcanvas-body">
            <div class="list-group">
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                href="{% url 'core:register_user_admin' %}">
                <i class="fa-solid fa-user-plus"></i> Registrar usuario
              </a>
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2" href="{% url 'core:admin_users_list' %}">
                <i class="fa-solid fa-users"></i> Listar usuarios
              </a>
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2" href="#">
                <i class="fa-solid fa-user-pen"></i> Editar / Desactivar
              </a>
            </div>
          </div>
        </div>
        {% endif %}

    <!-- MENSAJES (opcional: Django messages) -->
    {% if messages %}
    <div class="container center-wrap mt-3">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'primary' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- CONTENIDO -->
    <main class="page-body">
      <div class="container center-wrap py-4">
        {% block content %}{% endblock %}
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="border-top bg-white py-3">
      <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
        <span class="small text-secondary">© {{ now|date:"Y" }} AhorraLuz — Hogares más eficientes</span>
        <ul class="nav small">
          <li class="nav-item"><a href="" class="nav-link text-secondary">Privacidad</a></li>
          <li class="nav-item"><a href="" class="nav-link text-secondary">Términos</a></li>
          <li class="nav-item"><a href="" class="nav-link text-secondary">Soporte</a></li>
        </ul>
      </div>
    </footer>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <!-- JS propio -->
  <script src="{% static 'core/js/main.js' %}"></script>

  {% block extra_js %}{% endblock %}
</body>

</html>